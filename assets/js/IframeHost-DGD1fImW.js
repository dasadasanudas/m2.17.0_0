import{q as e,B as t,A as a,L as i,n as s}from"./icon-alert-Cei3Tz55.js";import{I as r}from"./IframeMessenger-CZMsBVeI.js";import{_ as n}from"./icon-error-state-BKQhfBCj.js";const f=e({name:"IframeHost",props:{messenger:{type:Object,required:!0},startingHeight:{type:String,default:"100%"},fallbackUrl:{type:String,default:""},fallbackTimeoutDelay:{type:Number,default:8e3},allow:{type:String,default:""},loadingSpinner:{type:Boolean,default:!0}},setup:()=>({iframe:t(),offlineTimeout:void 0}),data(){return{height:this.startingHeight,iframeOffline:!1,iframeLoading:!0}},computed:{ready(){return this.messenger.connected}},mounted(){this.messenger.addMessageListener(r,this.updateIframeHeight)},destroyed(){clearTimeout(this.offlineTimeout)},methods:{async onIframeLoad(){if(!this.iframe)return this.setIframeOffline();this.iframeLoading=!1,this.offlineTimeout=setTimeout((()=>{this.messenger.connected||this.setIframeOffline()}),this.fallbackTimeoutDelay),await this.messenger.connect(this.iframe)},updateIframeHeight({height:e}){this.height=e??this.startingHeight},setIframeOffline(){a.capture("iframe offline show",{feature:this.messenger.id}),this.iframeOffline=!0},captureFallbackClick(){a.capture("iframe fallback click",{feature:this.messenger.id})}}}),o=()=>{i(((e,t)=>({"0c84513f":e.height})))},l=f.setup;f.setup=l?(e,t)=>(o(),l(e,t)):o;const m=s(f,(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"iframe-host"},[t("transition",{attrs:{name:"fade",mode:"out-in"}},[e.iframeOffline?t("div",{key:"offline",staticClass:"iframe-offline"},[e._t("offline",(function(){return[t("inline-svg",{staticClass:"icon icon-error",attrs:{src:n}}),t("p",[e._v("Oops! Looks like something went wrong."),t("br"),e._v("Please continue on our website.")]),e.fallbackUrl?t("a",{staticClass:"button",attrs:{href:`${e.fallbackUrl}?fallback=true`,"data-test":"fallback-button",target:"_blank"},on:{click:e.captureFallbackClick}},[e._v(" Continue ")]):e._e()]}))],2):t("iframe",{key:"iframe",ref:"iframe",staticClass:"iframe-frame",attrs:{src:e.messenger.url,"data-test-loaded":e.ready,allow:e.allow,allowtransparency:!0},on:{load:e.onIframeLoad}})]),t("transition",{attrs:{name:"fade"}},[e.iframeLoading&&e.loadingSpinner?t("div",{staticClass:"iframe-loading"},[t("div",{staticClass:"loading-spinner"})]):e._e()])],1)}),[],!1,null,"af782b6b").exports;export{m as I};