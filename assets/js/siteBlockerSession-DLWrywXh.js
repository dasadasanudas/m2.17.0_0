import{d as e,k as t,p as s,u as i,l as r,m as o}from"./icon-alert-Cei3Tz55.js";import{d as a,e as n,F as c}from"./index-xreAsusa.js";import{u as l,a as d}from"./siteBlockerGroups-BWyYGTCQ.js";import{S as p,a as u,b as g}from"./constants-DNx-NqfY.js";import{useFocusModeDashViewStateStore as h}from"./focusModeViewState-DzdkaS0D.js";import{u as S}from"./pomodoroCompleted-CChcDNoN.js";import{g as j}from"./focusModeHelpers-CJvjcTIo.js";import{c as w}from"./reactiveCustomization-D0v-tpvX.js";import"./localStorage-BThj8CCp.js";import"./preload-helper-xKIU3iAw.js";import"./string-CbqVM-Zr.js";import"./migrateLegacyUserMessageHandler-aPkGeFs_.js";import"./main-Bw6ngw5x.js";import"./compareObjects-BF7sSNEf.js";import"./ViewState-Wts6aMTb.js";import"./VueBase-DhIJfHAY.js";import"./index-CJJH83pl.js";import"./portal-vue.esm-D8ZiK_2v.js";import"./PomodoroTimers-BWkB-14p.js";import"./loginHelpers-CQ1ZDpQp.js";import"./authService-piMSfLVB.js";import"./customization-C9MvloB8.js";const v=new a(p,!1),b=new a(u,""),f=e("siteBlockerSession",{state:()=>({active:v.currentValue,hasPermissions:!1}),getters:{urls:()=>[...l().items.reduce(((e,t)=>t.enabled?(d().getWebsitesByGroup(t).filter((e=>e.enabled)).forEach((t=>e.add(t.hostWithWildcard))),e):e),new Set([]))].join(" "),settingsEnabled:()=>w.siteBlockerVisible,focusModeEnabledAndFocusModeSettingActive:()=>n.currentValue&&j().apps.siteBlocker.enabled&&h().activeViewId===c.Focusing.toString(),featureEnabled:()=>m.conditionalFeatures.featureEnabled("site-blocker")||n.currentValue,activeAndBlockingUrls:e=>e.active&&e.hasPermissions&&0!==l().items.length},actions:{toggleActive(e){const t=e??!this.active;t&&this.checkSiteBlockerFeatureDisabledAndOpenUpsell()||(t&&this.registerOrUpdateContentScript(),this.active=t)},async ensurePermissions(e=!1){return this.hasPermissions?await this.registerOrUpdateContentScript():new Promise((t=>{m.cmd("modal.open","PERMISSION_REQUEST",{source:"Site Blocker",reason:"To block sites while focusing",permissions:g,requestImmediately:e,resolve:async e=>{if(!e)return t(!1);this.hasPermissions=!0,await this.registerOrUpdateContentScript(),t(!0)},extraInstructions:o()?' Please select "Always allow on every website..."':"",watchPermissionCheck:!0})}))},async registerOrUpdateContentScript(){if(!t().scripting)return;const e=await t().scripting.getRegisteredContentScripts();return await new Promise((s=>{t().scripting[e.length?"updateContentScripts":"registerContentScripts"]([{id:"site-blocker",js:["/content-scripts/siteBlocker.js"],matches:["*://*/*"],runAt:"document_start"}],(()=>s(!0)))}))},checkSiteBlockerFeatureDisabledAndOpenUpsell(){return!this.featureEnabled&&(m.cmd("modal.open","UPSELL_SITE_BLOCKER",{eventSource:"site-blocker"}),!0)}}});(async()=>{const e=f(),o=l(),a=d(),m=S(),p=h();v.switchOverToWatchedStoreItem((()=>e.active)),t().permissions&&s.permissions.contains(g).then((t=>{e.hasPermissions=t,t&&e.active&&e.registerOrUpdateContentScript()})),await i((()=>m.loaded)).toBe(!0),n.currentValue&&await i((()=>p.activeViewId)).toBe(c.Focusing),r([()=>n.currentValue,()=>e.focusModeEnabledAndFocusModeSettingActive,()=>m.anyFocusTimerActive,()=>m.playing,()=>e.featureEnabled,()=>e.settingsEnabled],(([t,s,i,r,o,a])=>{o&&a||e.toggleActive(!1),t&&(s&&i&&r?e.toggleActive(!0):e.toggleActive(!1))})),await i((()=>o.loaded)).toBe(!0),await i((()=>a.loaded)).toBe(!0),b.switchOverToWatchedStoreItem((()=>e.urls))})();export{f as default};