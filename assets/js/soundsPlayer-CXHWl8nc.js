import{p as e,D as t,e as a,F as i}from"./index-xreAsusa.js";import{a4 as s,a3 as o,M as n,d as c,V as d,E as l,aE as r,u,T as h,w as b,l as p}from"./icon-alert-Cei3Tz55.js";import{S as g,u as f,b as v}from"./state-Te6231FT.js";import{u as y}from"./preload-helper-xKIU3iAw.js";import{K as k,O as S}from"./localStorage-BThj8CCp.js";import{a as w}from"./IframeMessenger-CZMsBVeI.js";import{g as I}from"./focusModeHelpers-CJvjcTIo.js";import{useFocusModeDashViewStateStore as T}from"./focusModeViewState-DzdkaS0D.js";import{u as N}from"./pomodoroCompleted-CChcDNoN.js";import{c as A}from"./reactiveCustomization-D0v-tpvX.js";const C=.5,O="sounds:spotify:volumeWarning",P="Spotify may be loud: use device volume",V="Spotify may be loud: autoplay disabled, check device volume",B="Spotifyâ€™s player does not allow a volume control. You can still change volume by using your operating system controls.",G=[{label:"Recent",value:""},{label:"Soundscapes",value:g.Soundscapes},{label:"Spotify",value:g.Spotify},{label:"Youtube",value:g.Youtube}],x=e=>{const t=e.createGain();return t.gain.setValueAtTime(.001,e.currentTime),t},M=async(e,t,a)=>{const i=t.gain.value,s=i>a,o=e.currentTime,n=o+.5*(s?1.5:1);return 0===a&&0===i?Promise.resolve():(a<.001&&(a=.001),t.gain.cancelScheduledValues(o),t.gain.setValueAtTime(i,o),s?t.gain.exponentialRampToValueAtTime(a,n):t.gain.linearRampToValueAtTime(a,n),new Promise((i=>{const s=e.createBufferSource();s.buffer=e.createBuffer(1,1,e.sampleRate),s.connect(e.destination),s.start(n),s.addEventListener("ended",(()=>{const s=t.gain.value-.001<.001;.001===a&&s&&t.gain.setValueAtTime(0,e.currentTime),i()}))})))},E=(e,t)=>{const a=e.createStereoPanner();return a.pan.setValueAtTime(t,e.currentTime),a},F=(e,t)=>{const a=e.createOscillator();return a.type="sine",a.frequency.setValueAtTime(t,e.currentTime),a};class j{constructor(e,t,a,i,s){this.id=e,this.audioContext=i,this.started=!1,this.leftGainNode=x(this.audioContext),this.rightGainNode=x(this.audioContext),this.leftOscNode=F(this.audioContext,t),this.rightOscNode=F(this.audioContext,t+a),this.leftPannerNode=E(this.audioContext,-1),this.rightPannerNode=E(this.audioContext,1),this.leftGainNode.connect(this.leftPannerNode),this.rightGainNode.connect(this.rightPannerNode),this.leftPannerNode.connect(s),this.rightPannerNode.connect(s)}play(e){this.leftOscNode.connect(this.leftGainNode),this.rightOscNode.connect(this.rightGainNode),this.started||(this.leftOscNode.start(),this.rightOscNode.start(),this.started=!0),M(this.audioContext,this.leftGainNode,e),M(this.audioContext,this.rightGainNode,e)}async pause(){await Promise.all([M(this.audioContext,this.leftGainNode,0),M(this.audioContext,this.rightGainNode,0)]),0===this.volume&&(this.leftOscNode.disconnect(),this.rightOscNode.disconnect())}get volume(){return this.leftGainNode.gain.value}set volume(e){this.leftGainNode.gain.setValueAtTime(e,this.audioContext.currentTime),this.rightGainNode.gain.setValueAtTime(e,this.audioContext.currentTime)}}class D{constructor(e,t,a,i){this.id=e,this.url=t,this.audioContext=a,this.started=!1,this.loading=!1,this.gainNode=x(this.audioContext),this.bufferSourceNode=this.audioContext.createBufferSource(),this.bufferSourceNode.loop=!0,this.gainNode.connect(i)}async loadAudioFile(){return s.get(this.url,{responseType:"arraybuffer"}).then((e=>this.audioContext.decodeAudioData(e.data))).then((e=>{this.bufferSourceNode.buffer=e}))}play(e){this.started||this.loading?this.started&&(this.bufferSourceNode.connect(this.gainNode),M(this.audioContext,this.gainNode,e)):(this.loading=!0,this.loadAudioFile().then((()=>{this.bufferSourceNode.start(),this.started=!0,this.play(e)})).catch((()=>{console.error("Unable to fetch audio file",this.id)})).finally((()=>{this.loading=!1})))}async pause(){await M(this.audioContext,this.gainNode,0),0===this.volume&&this.bufferSourceNode.disconnect()}get volume(){return this.gainNode.gain.value}set volume(e){this.gainNode.gain.setValueAtTime(e,this.audioContext.currentTime)}}const L={fire:{icon:"flame",title:"Fire",url:"https://content.momentumdash.com/blogimages/276f1472-734e-492c-9138-c1584fb6cd80"},crickets:{icon:"tent-tree",title:"Crickets",url:"https://content.momentumdash.com/blogimages/bdab645f-d5d8-4e1e-b6e4-cbd4677fbe92"},ocean:{icon:"waves",title:"Ocean",url:"https://content.momentumdash.com/blogimages/3f851f30-5854-4fdb-805a-3f302ba56a81"},wind:{icon:"wind",title:"Wind",url:"https://content.momentumdash.com/blogimages/ebcb630e-5cb3-4a64-a2d4-eec16c9abf41"},seagulls:{icon:"waves-birds",title:"Seagulls",url:"https://content.momentumdash.com/blogimages/c0b4e5c6-ab66-42ce-aea3-5d6a419583cb"},tracks:{icon:"train-track",title:"Train Tracks",url:"https://content.momentumdash.com/blogimages/38228a91-cfa9-45b1-ada9-c16b619c2568"},rainOnSurface:{icon:"cloud-rain-wind",title:"Rain on Surface",url:"https://content.momentumdash.com/blogimages/08e95b57-7dbe-4ba8-83a7-8b19fc254ae1"},rain:{icon:"umbrella",title:"Rain",url:"https://content.momentumdash.com/blogimages/eac6cdc4-1f53-4fc5-92dd-0a4c053de028"},birds:{icon:"bird",title:"Birds",url:"https://content.momentumdash.com/blogimages/84d9d4e7-1d54-4300-a347-8f2650eafd51"},insects:{icon:"bug",title:"Insects",url:"https://content.momentumdash.com/blogimages/5875d483-396c-4bfe-a5d4-160384c18832"},chimes:{icon:"chimes",title:"Chimes",url:"https://content.momentumdash.com/blogimages/c30b03c9-91e0-43ce-9aa9-199e7aa0b76a"},cafe:{icon:"coffee",title:"Cafe",url:"https://content.momentumdash.com/blogimages/6f8cf03d-c7f2-45b7-898d-576385236122"},coffeeMaker:{icon:"coffeemaker",title:"Coffee Maker",url:"https://content.momentumdash.com/blogimages/43769f50-e91e-4595-91b4-8248372f39d2"},thunder:{icon:"zap",title:"Thunder",url:"https://content.momentumdash.com/blogimages/8291e604-c11a-4b45-b844-2e464527a2e1"},loudRain:{icon:"droplets",title:"Loud Rain",url:"https://content.momentumdash.com/blogimages/31fca0bf-8792-458f-8c13-f605b5618275"},stream:{icon:"creek",title:"Stream",url:"https://content.momentumdash.com/blogimages/2374f3af-35fd-4ab8-96c3-5e70775ca33a"},coWorkers:{icon:"speech",title:"Co-Workers",url:"https://content.momentumdash.com/blogimages/7a5fc995-0278-4386-bf30-b5672dfdd95b"},copier:{icon:"printer",title:"Copier",url:"https://content.momentumdash.com/blogimages/3e1f826c-dca2-4fe7-a10f-bf07c56ecfa8"},airConditioner:{icon:"air-vent",title:"Air Conditioner",url:"https://content.momentumdash.com/blogimages/e55e01b5-6fe8-43b3-b50b-18ce4f670472"},fluorescentHum:{icon:"fluorescent",title:"Fluorescent Hum",url:"https://content.momentumdash.com/blogimages/58fdb1ba-8821-4abe-8daf-704ee656e369"},mechanicalKeyboard:{icon:"keyboard",title:"Mechanical Keyboard",url:"https://content.momentumdash.com/blogimages/f295aec4-9d59-47b2-b31a-ba88f23d4628"},binauralMusic:{icon:"music",title:"Binaural Music",url:"https://content.momentumdash.com/blogimages/2bac8323-2a2f-4d55-93a8-2f988b81e71c"},oceanWaves:{icon:"waves",title:"Ocean Waves",url:"https://content.momentumdash.com/blogimages/179cb427-0d11-4b87-aa7f-ee57ee4228e4"},oceanBirds:{icon:"waves-birds",title:"Ocean Birds",url:"https://content.momentumdash.com/blogimages/f9898015-baa1-49a0-a0b2-706423293d58"},oceanSplash:{icon:"ocean-splash",title:"Ocean Splash",url:"https://content.momentumdash.com/blogimages/cc6f13b2-b6f9-4847-8374-f6a60ab0a88e"},oceanBubbles:{icon:"ocean-bubbles",title:"Ocean Bubbles",url:"https://content.momentumdash.com/blogimages/cf998930-0b21-491e-bd81-31ded5bb6374"},oceanBoat:{icon:"sailboat",title:"Ocean Boat",url:"https://content.momentumdash.com/blogimages/ed7871c2-d338-4e40-b147-4bd14cbc5fce"},brownNoise:{icon:"noise-brown",title:"Brown Noise",url:"https://content.momentumdash.com/blogimages/6b3a6411-4bb3-405b-b950-bfa39b50f0a0"},greenNoise:{icon:"noise-green",title:"Green Noise",url:"https://content.momentumdash.com/blogimages/bd4db9c8-751d-4dc3-9d0e-47f0eabf8352"},pinkNoise:{icon:"noise-pink",title:"Pink Noise",url:"https://content.momentumdash.com/blogimages/fd25b1c1-eb5f-42e1-9987-d1561e6cedeb"},whiteNoise:{icon:"noise-white",title:"White Noise",url:"https://content.momentumdash.com/blogimages/1eb0e3e7-bdce-458b-a162-2f0d71b1aee9"},airplaneCabin:{icon:"plane",title:"Airplane Cabin",url:"https://content.momentumdash.com/blogimages/1f20412d-c25d-4d1b-876c-630245553678"},speechBlocker:{icon:"speech-blocker",title:"Speech Blocker",url:"https://content.momentumdash.com/blogimages/f15fa784-2077-431f-b969-19bf99a87589"},binauralDelta:{icon:"binaural-delta",title:"Binaural Delta",frequency:98,difference:2},binauralTheta:{icon:"binaural-theta",title:"Binaural Theta",frequency:92,difference:8},binauralAlpha:{icon:"binaural-alpha",title:"Binaural Alpha",frequency:170,difference:10},binauralBeta:{icon:"binaural-beta",title:"Binaural Beta",frequency:125,difference:25},binauralGamma:{icon:"binaural-gamma",title:"Binaural Gamma",frequency:170,difference:40}};class R{constructor(){this.globalAudioContext=new AudioContext,this.globalGainNode=this.globalAudioContext.createGain(),this.globalGainNode.connect(this.globalAudioContext.destination),this.mediaSessionAudioElement=new Audio("/sounds/silence.mp3"),this.mediaSessionAudioElement.loop=!0,this.activeTracks=new Set([]),this.pausedTracks=new Set([]),this.tracks=Object.entries(L).reduce(((e,[t,a])=>(e[t]="url"in a?new D(t,a.url,this.globalAudioContext,this.globalGainNode):new j(t,a.frequency,a.difference,this.globalAudioContext,this.globalGainNode),e)),{})}async playTrack(e,t){const a=this.tracks[e];a&&(0===this.activeTracks.size&&(await this.globalAudioContext.resume(),await this.mediaSessionAudioElement.play()),a.play(t),this.activeTracks.add(e))}async pauseTrack(e){const t=this.tracks[e];t&&(this.activeTracks.delete(e),await t.pause(),0===this.activeTracks.size&&"suspended"!==this.globalAudioContext.state&&(this.mediaSessionAudioElement.pause(),await this.globalAudioContext.suspend()))}setTrackVolume(e,t){const a=this.tracks[e];a&&(a.volume=t,0===t&&a.pause())}setGlobalVolume(e){0===this.globalGainNode.gain.value&&0!==e&&(this.pausedTracks.forEach((t=>{this.playTrack(t,e)})),this.pausedTracks.clear()),this.globalGainNode.gain.setValueAtTime(e,this.globalAudioContext.currentTime),0===e&&this.activeTracks.forEach((e=>{this.pausedTracks.add(e),this.pauseTrack(e)}))}}class K{constructor(e){this.dataSyncService=e}get(e){this.dataSyncService.get(e)}create(e){return this.dataSyncService.create(e.id,e)}update(e,t){return this.dataSyncService.update(e,t)}delete(e){return this.dataSyncService.delete(e)}}class W{constructor({id:e=y(),icon:t="icon/apps/sounds",title:a="",thumbnailSrc:i="",defaultKey:s="",defaultDeleted:o=!1,singleTrackOnly:n=!1,tracks:c=[]}){this.id=e,this.icon=t,this.title=a,this.thumbnailSrc=i,this.defaultKey=s,this.defaultDeleted=o,this.singleTrackOnly=n,this.type=g.Soundscapes,this.tracks=c}}const q=(_=[{id:"8490eba8-6703-4d4e-9511-1ebed3eaffc1",title:"Noise",key:"noise",icon:"white-noise",singleTrackOnly:!0,tracks:[{id:"brownNoise",volume:1},{id:"greenNoise",volume:1},{id:"pinkNoise",volume:1},{id:"whiteNoise",volume:1},{id:"airplaneCabin",volume:1},{id:"speechBlocker",volume:1}]},{id:"61e3c71c-aac7-4f20-bbcc-c8b3c0c5ddad",title:"Binaural",key:"binaural",icon:"binaural",singleTrackOnly:!0,tracks:[{id:"binauralDelta",volume:1},{id:"binauralTheta",volume:1},{id:"binauralAlpha",volume:1},{id:"binauralBeta",volume:1},{id:"binauralGamma",volume:1},{id:"binauralMusic",volume:1}]},{id:"53b01a5c-c458-4fc1-8460-72a809355775",title:"Ocean",key:"ocean",icon:"ship",tracks:[{id:"oceanBoat",volume:.5},{id:"oceanWaves",volume:.3},{id:"oceanBirds",volume:.2},{id:"oceanSplash",volume:.5},{id:"oceanBubbles",volume:.8}]},{id:"289afcfa-6f78-4440-b495-2ce9b04d9e2c",title:"Campfire",key:"campfire",icon:"flame-kindling",tracks:[{id:"fire",volume:.9},{id:"crickets",volume:.2}]},{id:"c51f90b7-2b8d-4480-8b52-5e74f844754d",title:"Beach",key:"beach",icon:"palm-tree-island-sun",tracks:[{id:"ocean",volume:.5},{id:"wind",volume:.15},{id:"seagulls",volume:.05}]},{id:"a8689038-2a3c-42b3-b447-01ea2b725ea6",title:"Train",key:"train",icon:"train-front",tracks:[{id:"tracks",volume:.9},{id:"wind",volume:.1}]},{id:"6b6a0fdb-279a-4a7d-91f0-dee889662be3",title:"Rainfall",key:"rainfall",icon:"cloud-rain-wind",tracks:[{id:"rainOnSurface",volume:.5},{id:"rain",volume:.5}]},{id:"0983192d-93bc-4df1-8cea-93ee10d74f70",title:"Forest",key:"forest",icon:"trees",tracks:[{id:"birds",volume:.75},{id:"wind",volume:.1},{id:"insects",volume:.05}]},{id:"8b603dd4-429a-4185-b07b-ff588f36c366",title:"Garden",key:"garden",icon:"garden",tracks:[{id:"chimes",volume:.5},{id:"insects",volume:.01},{id:"wind",volume:.1}]},{id:"68a096d5-e57e-4c50-9758-7cad011562aa",title:"CafÃ©",key:"cafe",icon:"coffee",tracks:[{id:"cafe",volume:.7},{id:"coffeeMaker",volume:.1}]},{id:"e491a1b5-1f63-44c9-bd97-4c148c5b573f",title:"Thunderstorm",key:"thunderstorm",icon:"cloud-lightning",tracks:[{id:"thunder",volume:.9},{id:"loudRain",volume:.55},{id:"wind",volume:.45},{id:"rain",volume:.25}]},{id:"a810c333-5c40-4840-b269-8c964efe55d5",title:"Creek",key:"creek",icon:"creek",tracks:[{id:"stream",volume:.2},{id:"wind",volume:.1}]},{id:"3d98b606-b8c6-4ba3-9b60-f36505fefe6a",title:"Office",key:"office",icon:"building",tracks:[{id:"coWorkers",volume:.13},{id:"copier",volume:.08},{id:"airConditioner",volume:.07},{id:"fluorescentHum",volume:.03},{id:"mechanicalKeyboard",volume:.01}]},{id:"ff168191-2fed-4262-a380-696b6cb1631a",title:"Custom",key:"custom",icon:"custom",tracks:Object.keys(L).map((e=>({id:e,volume:.5,active:!1,advanced:!1})))}],Object.fromEntries(_.map((e=>[e.id,{id:e.id,type:g.Soundscapes,title:e.title,tracks:e.tracks.map(((t,a)=>({...t,active:void 0===t.active&&(!e.singleTrackOnly||0===a),advanced:!1}))),lastPlayedAt:0,defaultKey:e.key,defaultDeleted:!1,singleTrackOnly:!!e.singleTrackOnly,thumbnailSrc:"custom"===e.key?"":`/img/sounds/${e.key}.jpg`,icon:`icon/sounds/${e.icon}`}]))));var _;const Y=(({soundsSoundscapesService:e,soundsSoundscapesTracksPlayerService:t}=(()=>({soundsSoundscapesTracksPlayerService:new R,soundsSoundscapesService:new K(new o("soundsSoundscapes",{mode:n.Cache}))}))())=>c("soundsSoundscapes",{state:()=>({data:{},loading:!1,loaded:!1}),getters:{items:e=>(e=>{const t=Object.values(e);return Object.values(q).reduce(((e,a)=>(t.some((e=>e.defaultKey===a.defaultKey))||e.push(a),e)),t).filter((e=>!e.defaultDeleted))})(e.data).map((e=>new W(e))),getSoundscapeOrDefaultFromId:e=>t=>{const a=e.data[t]??q[t];if(a)return new W(a)}},actions:{refresh(){this.loading||this.loaded||(this.loading=!0,e.get({success:e=>{this.data=Object.fromEntries(e.map((e=>[e.id,e]))),this.loaded=!0,this.loading=!1},failure:()=>{this.loading=!1}}))},async create(t){t.tracks=structuredClone(t.tracks),d.set(this.data,t.id,t),await e.create(t)},async update(t,a){const i=q[t];if(!this.data[t]&&i)return this.create({...i,...a});const s=this.data[t];if(!s)throw new l({message:`No Soundscape found with id: ${t}`});d.set(this.data,t,{...s,...a}),await e.update(t,a)},async delete(t){const a=this.getSoundscapeOrDefaultFromId(t);if(a){if(a.defaultKey)return this.update(t,{defaultDeleted:!0});d.delete(this.data,t),await e.delete(t)}},async play(e){const a=this.getSoundscapeOrDefaultFromId(e);if(!a)throw new l({message:`No Soundscape found with id: ${e}`});await Promise.all(a.tracks.map((e=>e.volume&&e.active?t.playTrack(e.id,e.volume):Promise.resolve())))},async pause(e){const a=this.getSoundscapeOrDefaultFromId(e);a&&await Promise.all(a.tracks.map((e=>e.volume&&e.active?t.pauseTrack(e.id):Promise.resolve())))},async updateTrack(e,a,i){const s=this.getSoundscapeOrDefaultFromId(e),o=null==s?void 0:s.tracks,n=null==o?void 0:o.find((e=>e.id===a));s&&n&&o&&(i.volume&&t.setTrackVolume(a,i.volume),!1===i.active?t.pauseTrack(a):!0===i.active&&t.playTrack(a,i.volume??n.volume),i.active&&s.singleTrackOnly&&o.forEach((e=>{e.id!==a&&e.active&&(e.active=!1,t.pauseTrack(e.id))})),i.volume&&(n.volume=i.volume),void 0!==i.active&&(n.active=i.active),void 0!==i.advanced&&(n.advanced=i.advanced),await this.update(e,{tracks:o}))},setGlobalVolume(e){t.setGlobalVolume(e)}}}))(),H=new k("oembed",1);const $=new class{constructor(){this.db=H}async getData(e,t,a=!1){const i=await this.db.get(t);if((!i||i.data.fetch_timestamp<Date.now()-r)&&(a=!0),a)try{const a=(await s.get(t)).data;a.id=e,a.fetch_timestamp=Date.now(),await this.db.set(t,{data:a})}catch(o){if(console.error(o),!i)throw o}return(await this.db.get(t)).data}},z=new S("sounds");function Q(){return z.getConfig()}const U=(()=>{const e=c("soundsYoutube",{state:()=>({data:[],loaded:!1,loading:!1,loadingPlayer:!1,playerItemId:"",syncingState:!1,messenger:new w("sounds/youtube")}),getters:{getOEmbedLink:()=>e=>`https://www.youtube.com/oembed?url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D${e}&format=json`,items:e=>e.data.map((e=>({type:g.Youtube,thumbnailSrc:e.thumbnail_url,id:e.id,title:e.title})))},actions:{refresh(){this.loading||this.loaded||(this.loading=!0,(async()=>{const e=(await Q()).youtube.map((e=>({data:$.getData(e,this.getOEmbedLink(e))})));await Promise.all(e.map((e=>e.data.then((t=>e.result=t))))),this.data=e.map((e=>({...e.result}))),this.loading=!1,this.loaded=!0})().catch((e=>{console.error(e),this.loading=!1})))},async play(e,t){if(this.syncingState||this.loadingPlayer)return;this.playerItemId!==e&&(this.playerItemId=e,this.loadingPlayer=!0);const a=f();a.activeViewItemId=e,a.popupEnabled=!0,await u((()=>a.popupFirstMounted)).toBe(!0),$.getData(e,this.getOEmbedLink(e),!0),await u((()=>this.messenger.connected)).toBe(!0),await this.messenger.sendMessageAndGetResponse("sounds:loadTrack",{id:e}),t&&this.messenger.sendMessage("sounds:play"),setTimeout((()=>{this.loadingPlayer=!1}),500)},pause(){this.syncingState||this.messenger.sendMessage("sounds:pause")},setGlobalVolume(e){this.syncingState||this.messenger.sendMessage("sounds:setVolume",{volume:e})}}}),t=e();return t.messenger.addMessageListener("sounds:ready",(()=>{setTimeout((()=>{t.loadingPlayer=!1}),500)})),t.messenger.addMessageListener("sounds:sync:playing",(async()=>{const e=X();t.syncingState=!0,await e.update({paused:!1}),t.syncingState=!1})),t.messenger.addMessageListener("sounds:sync:paused",(async()=>{const e=X();t.syncingState=!0,await e.update({paused:!0}),t.syncingState=!1})),e})(),J=(()=>{const e=c("soundsSpotify",{state:()=>({data:[],loaded:!1,loading:!1,loadingPlayer:!1,playerItemId:"",syncingState:!1,messenger:new w("sounds/spotify")}),getters:{getOEmbedLink:()=>e=>`https://open.spotify.com/oembed?url=https%3A%2F%2Fopen.spotify.com%2Fplaylist%2F${e}`,items:e=>e.data.map((e=>({type:g.Spotify,thumbnailSrc:e.thumbnail_url,id:e.id,title:e.title})))},actions:{refresh(){this.loading||this.loaded||(this.loading=!0,(async()=>{const e=(await Q()).spotify.map((e=>({data:$.getData(e,this.getOEmbedLink(e))})));await Promise.all(e.map((e=>e.data.then((t=>e.result=t))))),this.data=e.map((e=>({...e.result}))),this.loading=!1,this.loaded=!0})().catch((e=>{console.error(e),this.loading=!1})))},async play(e,t){if(this.syncingState||this.loadingPlayer)return;this.playerItemId!==e&&(this.playerItemId=e,this.loadingPlayer=!0);const a=f();a.activeViewItemId=e,a.popupEnabled=!0,await u((()=>a.popupFirstMounted)).toBe(!0),$.getData(e,this.getOEmbedLink(e),!0),await u((()=>this.messenger.connected)).toBe(!0),await this.messenger.sendMessageAndGetResponse("sounds:loadTrack",{id:e}),t&&this.messenger.sendMessage("sounds:play"),setTimeout((()=>{this.loadingPlayer=!1}),500)},pause(){this.syncingState||this.messenger.sendMessage("sounds:pause")},setGlobalVolume(){},skip(){this.messenger.sendMessage("sounds:skip")}}}),t=e();return t.messenger.addMessageListener("sounds:sync:playing",(async()=>{const e=X();t.syncingState=!0,await e.update({paused:!1}),t.syncingState=!1})),t.messenger.addMessageListener("sounds:sync:paused",(async()=>{const e=X();t.syncingState=!0,await e.update({paused:!0}),t.syncingState=!1})),e})(),X=e((({loadedRef:e,updatingRef:s,updateAsync:o})=>{const n=new t("sounds:player:lock:name",{default:null}),d=c("soundsPlayer",{state:()=>({activeItem:v.currentValue,paused:!0,autoplay:!0,muted:!1,globalVolume:.5,activeTabId:"",lastPlayedIds:[]}),getters:{allItems(){const e=[...Y().items,...J().items,...U().items];return Object.fromEntries(e.map((e=>[e.id,e])))},allItemsOrdered(e){const t={...this.allItems},a=[];return e.lastPlayedIds.forEach((e=>{const i=t[e];i&&(a.push(i),delete t[e])})),[...a,...Object.values(t)]},loaded:()=>e.value,loadedAllItems:()=>Y().loaded&&U().loaded&&J().loaded,activeItemStore(e){if(e.activeItem)switch(e.activeItem.type){case g.Spotify:return J();case g.Youtube:return U();case g.Soundscapes:return Y()}},isActiveTab:e=>e.activeTabId===h,settingsEnabled:()=>A.soundscapesVisible,focusModeEnabledAndFocusModeSettingActive:()=>a.currentValue&&I().apps.soundscapes.enabled&&T().activeViewId===i.Focusing.toString(),featureEnabled:()=>m.conditionalFeatures.featureEnabled("plus")||a.currentValue,loadingActiveItemPlayer(){const e=J(),t=U();return e.loadingPlayer||t.loadingPlayer},activeItemRequiresIframe(e){var t,a;return(null==(t=e.activeItem)?void 0:t.type)===g.Spotify||(null==(a=e.activeItem)?void 0:a.type)===g.Youtube}},actions:{refresh(){Y().refresh(),J().refresh(),U().refresh()},async update(e){await o(e)},async play(e){var t,a,i;await u(s).toBe(!1);const o=(null==(t=this.activeItem)?void 0:t.id)===e?this.activeItem:this.allItems[e];if(!o)return;this.activeTabId!==h&&(await this.update({activeTabId:h}),n.stealLeadership(),await u(n.isLeader).toBe(!0));const c=[...this.lastPlayedIds],d=c.findIndex((t=>t===e));-1!==d&&c.splice(d,1),c.unshift(e);const l=o.type!==g.Spotify,r=(null==(a=this.activeItem)?void 0:a.type)!==g.Spotify;l&&!r&&await this.update({globalVolume:1});const m=o.type===g.Spotify&&this.globalVolume<.5,b=o.id===(null==(i=this.activeItem)?void 0:i.id)||!m;await this.update({activeItem:o,lastPlayedIds:c,autoplay:b,paused:!b})},async pause(){await this.update({paused:!0})},async toggleActiveItemPaused(){this.activeItem&&(this.paused?await this.play(this.activeItem.id):await this.pause())},async setGlobalVolume(e,t){await this.update({globalVolume:e,muted:t})},async playActiveItem(e){var t,a,i;const s=(null==(t=this.activeItem)?void 0:t.id)===e?this.activeItem:this.allItems[e];s&&(await(null==(a=this.activeItemStore)?void 0:a.play(s.id,this.autoplay)),null==(i=this.activeItemStore)||i.setGlobalVolume(this.muted?0:this.globalVolume),navigator.mediaSession&&(navigator.mediaSession.metadata=new MediaMetadata({title:s.title,artwork:[]}),navigator.mediaSession.playbackState="playing",s.type===g.Soundscapes&&navigator.mediaSession.setPositionState({duration:1/0}),navigator.mediaSession.setActionHandler("play",(()=>{this.play(e)})),navigator.mediaSession.setActionHandler("pause",(()=>{this.pause()}))))},async pauseActiveItem(e){var t;await(null==(t=this.activeItemStore)?void 0:t.pause(e)),navigator.mediaSession&&(navigator.mediaSession.playbackState="paused")},skip(){this.activeItemStore&&"skip"in this.activeItemStore&&this.activeItemStore.skip()}}}),l=d(),r=N(),f=T();return v.switchOverToWatchedStoreItem((()=>l.activeItem)),(async()=>{await u((()=>l.loaded)).toBe(!0),await u(n.isLeader).not.toBeNull(),n.isLeader.value&&l.update({activeTabId:"",paused:!0,activeItem:null}),b(n.isLeader,(e=>{e&&l.activeTabId!==h&&l.update({activeTabId:"",paused:!0})})),p([()=>l.globalVolume,()=>l.activeItem,()=>l.muted],(()=>{l.activeItemStore&&l.activeItemStore.setGlobalVolume(l.muted?0:l.globalVolume)})),b([()=>l.paused,()=>l.autoplay,()=>l.activeItem,()=>l.activeItemStore],(([e,t,a],[,,i,s])=>{!e&&i&&s&&i.id!==(null==a?void 0:a.id)&&s.pause(i.id),l.isActiveTab&&a&&(e&&t?l.pauseActiveItem(a.id):l.playActiveItem(a.id))})),await u((()=>r.loaded)).toBe(!0),a.currentValue&&await u((()=>f.activeViewId)).toBe(i.Focusing),p([()=>a.currentValue,()=>l.focusModeEnabledAndFocusModeSettingActive,()=>r.anyFocusTimerActive,()=>r.playing,()=>l.featureEnabled,()=>l.settingsEnabled],(([e,t,a,i,s,o])=>{if(s&&o||l.pause(),e)if(t&&a&&i){if(!l.paused||!n.isLeader.value)return;l.play(l.lastPlayedIds[0]??"6b6a0fdb-279a-4a7d-91f0-dee889662be3")}else l.pause()}))})(),d}),{mode:n.Cache,syncAutomatically:!0}),Z=Object.freeze(Object.defineProperty({__proto__:null,default:X},Symbol.toStringTag,{value:"Module"}));export{G as L,C as P,L as S,Y as a,W as b,U as c,J as d,B as e,O as f,V as g,P as h,Z as s,X as u};